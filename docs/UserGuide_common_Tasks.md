# Руководство к применению общих скриптов

В настоящем документе описываются сценарии, которые могут быть востребованы в различном ПО и реализация которых частично выполнена средствами библиотек нодов.

**Термины и сокращения**:

* MST = ModelStudio CSoft;

* nBIM = nanoCAD BIM Строительство (Архитектура, Конструкции);

## Квартирография

Процесс получения, анализа и расчета площадей помещений по требованиям квартирографии для проектирования жилых зданий. Основная логика в пакете NVP_Common, группа нодов Task.Kvartirografiya (исходный код <u>\src\NVP_Common\Task\Kvartirografiya.cs</u>).

Основной рабочий нод "Kvartirografiya_Calculate". Принимает на вход следующие  данные:

* `Свойства помещений`: словарь (Dictionary<string, object>) со свойствами объектов;

* `Уровень2Помещения`: сопоставление уровня с помещениями на нём (актуально, когда нумерация квартир не сквозная). Если = null, то не учитывается. Null может быть подан нодом NVP_Common.Common.Null;

Далее идут наименования свойств (параметров) с данными, хранящимися в `Свойства помещений`;

* `Свойство Идентификатор`: Имя свойства уникального идентификатора
  
  * В Renga может быть создано новое свойство произвольного имени, тип данных `Строка` и выражение `{Уникальный идентификатор}`.
  
  * В MST Строительные решения и nBIM может быть создан новый строковый параметр произвольного имени с формулой `=object.Handle`.
  
  * В Revit ... TODO.

* `Свойство Имя`: Наименование помещения. В Renga это характеристика помещения, может быть получена дублирующим строковым свойством с выражением `{Имя помещения}`;

* `Свойство Квартира`: Имя свойства, отсылающего на квартиру (также марка квартиры);

* `Свойство Площадь`: Имя свойства с площадью пола помещения
  
  * В Renga это расчетное свойство помещения, может быть получено как {Чистая площадь пола}, возможно с применением операции округления;
  
  * В MST параметр`AEC_ROOM_AREA_FULL`; 
  
  * В nBIM параметр `AEC_ROOM_AREA_MEASURED`;

* `Свойство Площадь с отделкой`: Имя свойств площади с отделкой, задается как правило некоей расчетной формулой/выражением;

* `Итог.Площадь Общая`: Имя свойство, куда будет записана суммарная Общая площадь квартиры;

* `Итог.Площадь Квартиры`: Имя свойство, куда будет записана суммарная Площадь квартиры;

* `Итог.Число помещений`:  Имя свойство, куда будет записано общее число всех помещений квартиры;

* `Жилые помещения`: Список наименований помещений, которые относятся к Жилым (по умолчанию, нод Kvartirografiya_Rooms_Living);

* `Нежилые помещения`: Список наименований помещений, которые относятся к Нежилым (по умолчанию, нод Kvartirografiya_Rooms_NonLiving);

* `Летние помещения`: Список наименований помещений, которые относятся к числу Летних или прочих (по умолчанию, нод Kvartirografiya_Rooms_Other);

* `Помещения без отделки`: Список наименований помещений, площади которых будут считаться без отделки (по умолчанию, нод Kvartirografiya_Rooms_WithoutOtd);

* `Коэффициенты площади`: Словарь с сопоставлением названия помещения и дробного числа (коэффициента площади), прочие названия будут считаться с k = 1.0 (по умолчанию, нод Kvartirografiya_Rooms_Coefficients2Areas);

* `Точность округления`: Величина округления (знаки после запятой) результирующих площадей для последующего отображения;

* `Игнорировать`: Возможность исключать площади помещений из общей статистики. Значение - строка вида "<u>Имя_свойство:Значение свойства</u>". Желательно иметь отдельное свойство с конкретным значением, а не использовать, например, факт пустого (не заполненного) свойства;

Скрипт-реализация для Renga см. в  `\samples\Renga\NVP_Renga_COM_Sample_Квартирография.nvproj`.

Важные замечания к использованию:

* Скрипт считает площади как есть (без поправок и округления), вы можете в качестве исходных данных подать на `Свойство Площадь` и `Свойство Площадь с отделкой`параметры (свойства) с скорректированной логикой расчета (запас, округление и пр.);

* Нод `Kvartirografiya_Calculate` возвращает 3 списка (в порядке очереди): Список наименований свойств, список значений свойств, Список строк таблицы-спецификации (Наименование помещения, Жилая площадь, Общая площадь, Площадь квартиры, Число комнат);

* Площадь ожидается в квадратных метрах;
